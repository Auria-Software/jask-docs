import { Steps } from 'nextra/components'
import { Callout } from 'nextra/components'
import { Bleed } from 'nextra/components'
import {Cards} from 'nextra/components'

# SharePoint

SharePoint est une plateforme collaborative qui s'intègre à Microsoft Office.
Ce guide vous donne un aperçu rapide de la connexion de SharePoint à Jask afin de créer des cas d'usage basés sur les données de l'organisation.

<Callout type="info">
Il est possible de connecter à Jask des Drives, des Pages ASPX et des Listes Sharepoint. Pour connecter une Liste Sharepoint, il est **obligatoire d'effectuer une manipulation complexe dans JaskSSO** qui n'est pas présente dans la documentation. Nous vous conseillons de **suivre cette documentation** puis **vous rapprocher d'une personne de l'équipe Jask.**
</Callout>

## Prérequis

Avant de commencer, assurez-vous que vous avez les éléments suivants:
- Une [app registry `JaskSSO`](/connectors/microsoft) configurée sur Microsoft Entra et ses informations renseignées dans `Gestion des secrets` sur Jask
- Un compte Jask avec le [rôle administrateur](/security/roles)
- Un compte SharePoint Administrateur 


## Guide



<Steps>



### Ajouter une autorisation d'API à l'app registry `JaskSSO`

Rendez vous sur le [portail Microsoft Entra](https://entra.microsoft.com/#view/Microsoft_AAD_RegisteredApps/ApplicationsListBlade/quickStartType~/null/sourceType/Microsoft_AAD_IAM) de l'app registry JaskSSO [(Suivre le guide ici pour créer JaskSSO)](/connectors/microsoft).

Naviguer dans `API autorisées` sur le menu de gauche puis cliquez sur le bouton `Ajouter une autorisation`.
Choisissez `Autorisations d'application` et selectionnez dans la liste l'autorisation `Sites.Selected`
 
```note filename="Scope (Autorisations d'application)"
Sites.Selected
```

![scopes](@public/sharepoint/scopes.png)

Vous devez valider le consentement de l'administrateur pour cette autorsation d'api. Vous verrez la validation dans la colonne `Status`.

<Callout type="warning" emoji="⚠️">
  Vous devez être administrateur ou avoir l'accord d'un **administrateur** pour appuyer sur `Grant admin consent`. 
</Callout>

![granted](@public/sharepoint/granted.png)

### Créer une app registry `JaskAdmin`

<Callout type="warning">
  Jask utilisera `JaskAdmin`uniquement pour **donner les droits d'accès** à `JaskSSO` depuis la console `source de données` dans Jask.
  **Jask ne passera jamais par `JaskAdmin`** pour accéder aux sites SharePoint.
  Cette étape est **obligatoire** pour pouvoir **donner accès à Jask via `JaskSSO`** d'accéder à des sites SharePoint de votre organisation. 
</Callout>

**1. Créer l'app registry `JaskAdmin`**

Ouvrez [le portail Microsoft Entra](https://entra.microsoft.com/#view/Microsoft_AAD_RegisteredApps/ApplicationsListBlade/quickStartType~/null/sourceType/Microsoft_AAD_IAM) et connectez-vous avec votre compte administrateur puis rendez vous sur la page `Inscription d'application` depuis le menu à gauche.
Cliquez sur `Nouvelle inscription` en haut à gauche pour créer une nouvelle applicaton.

![Microsoft Entra](@public/microsoft/Microsoft-New-App.png)

Nommez l'application `JaskAdmin` et entrez l'url de redirection suivante :

```url filename="url de redirection"
TODO
```

TODO : insérer l'image de paramétrage de l'application

Récupérer les identifiants `Application (client) id` et `Directory (tenant) id` de l'application JaskAdmin sur l'acceuil de l'application.

![Microsoft Entra App ID](@public/microsoft/Microsoft-App-ID.png)

 **2. Récupérer la valeur du `Secret` de l'app registry `JaskAdmin`**

Créer le secret de l'application en vous rendant dans `Certificates & secrets` dans le menu de gauche puis cliquez sur `Nouveau client secret`. Renseignez un nom par exemple `SecretAdmin`pour le secret et une expiration puis cliquez sur `Add`.

<Callout type="info">
Choisissez une date lointaine pour plus de tranquilité. Notez la date d'expiration pour recréer un secret au moment venu.
</Callout>

![Microsoft Entra Secret](@public/microsoft/Microsoft-New-Secret.png)

Récupérer la `Valeur` du secret pour la suite.

![Microsoft Entra Secret](@public/microsoft/Microsoft-Secret-Value.png)

**3. Ajouter l'autorisation d'API à l'app registry `JaskAdmin`**

Naviguer dans `API autorisées` sur le menu de gauche puis cliquez sur le bouton `Ajouter une autorisation`.
Choisissez `Autorisations d'application` et selectionnez dans la liste l'autorisation `Sites.FullControl.All`
 
```note filename="Scope (Autorisations d'application)"
Sites.FullControl.All
```

![scopes](@public/sharepoint/scopes.png)

Vous devez valider le consentement de l'administrateur pour cette autorsation d'api. Vous verrez la validation dans la colonne `Status`.

<Callout type="warning" emoji="⚠️">
  Vous devez être administrateur ou avoir l'accord d'un **administrateur** pour appuyer sur `Grant admin consent`. 
</Callout>

![granted](@public/sharepoint/granted.png)

**4. Configurer les clés dans `Gestion des secrets` sur Jask**

Rendez vous sur Jask. Cliquez sur `Sécurité` dans le menu de gauche puis sur `Gestion des secrets`. Rentrer le nom `JaskAdmin`, Séléctionnez `Connexion O365` puis ajoutez les identifiants récupérés à l'étape 1 et 2.

Choisissez la visibilité en fonction de qui peut utiliser cette clé pour donner les droits à `JaskSSO`. Nous vous conseillons de la partager qu'aux administrateurs connectant les sites sharepoints. Cliquez sur `Valider`.

![Jask Secret Management](@public/microsoft/Jask-Secret-Management.png)

Vous avez maintenant configuré l'application `JaskAdmin` dans Microsoft Entra et vous êtes prêt à donner les droits à JaskSSO avec JaskAdmin.

### Connecter un sharepoint à Jask

<Callout type="info">
  Jask via `JaskSSO` aura les autorisations de **lecture** et **d'écriture** qu'aux **sites selectionnés par l'administrateur**.
</Callout>

TODO : GIF création de source sharepoint sur Jask

</Steps>


## Utilisation du Sharepoint dans Jask

Vous pouvez utiliser cette **nouvelle source de données Sharepoint** dans Jask pour créer des cas d'usage basés sur les données de votre organisation.
Suivez la documentation suivante pour utiliser cette source dans les différentes ressources de Jask :

<Cards>
  <Cards.Card
    title="Créer un assistant"
    href="/docs/assistants/create"
  />
  <Cards.Card
    title="Créer une application"
    href="/docs/applications/create/intro"
  />
  <Cards.Card
    title="Recherche IA de document"
    href="/docs/ai_search/search"
  />
</Cards>